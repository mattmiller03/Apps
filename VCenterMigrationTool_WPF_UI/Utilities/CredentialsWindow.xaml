<Window x:Class="VCenterMigrationTool_WPF_UI.Utilities.CredentialsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Migration Credentials Manager" 
        Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        ui:WindowHelper.UseModernWindowStyle="True">

    <Window.Resources>
        <!-- Inherit styles from main window -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#FF2E86AB"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="CredentialTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="CredentialPasswordBoxStyle" TargetType="PasswordBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="CredentialButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="15,6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FF2E86AB"/>
            <Setter Property="Background" Value="#FF2E86AB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="🔑 Migration Credentials Manager" FontSize="20" FontWeight="Bold" 
                       Foreground="#FF2E86AB" Margin="0,0,0,5"/>
            <TextBlock Text="Securely store credentials needed for vCenter migration operations" 
                       FontSize="12" Foreground="Gray"/>
            <TextBlock Text="⚠️ Credentials are encrypted and stored locally for this session only" 
                       FontSize="11" Foreground="Orange" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- SSO Admin Credentials -->
                <GroupBox Header="🔐 SSO Administrator Credentials" Margin="0,0,0,20" 
                          BorderBrush="#FFDDDDDD" BorderThickness="1" Background="White">
                    <Grid Margin="15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.ColumnSpan="3" 
                                   Text="SSO Admin credentials for managing users, groups, and identity sources"
                                   FontSize="12" Foreground="Gray" Margin="0,0,0,15"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="SSOAdminUsernameTextBox" 
                                 Style="{StaticResource CredentialTextBoxStyle}"
                                 ToolTip="SSO Administrator username (e.g., administrator@vsphere.local)"/>
                        <Button Grid.Row="1" Grid.Column="2" Content="🧪 Test" Width="60" Height="32"
                                Click="TestSSOConnection_Click" Style="{StaticResource CredentialButtonStyle}"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                        <PasswordBox Grid.Row="2" Grid.Column="1" Name="SSOAdminPasswordBox" 
                                     Style="{StaticResource CredentialPasswordBoxStyle}"
                                     ToolTip="SSO Administrator password"/>

                        <CheckBox Grid.Row="3" Grid.Column="1" Name="SaveSSOCredentialsCheckBox" 
                                  Content="💾 Save SSO credentials for this session" Margin="0,5,0,0"/>

                        <TextBlock Grid.Row="4" Grid.Column="1" Name="SSOStatusText" 
                                   Text="Status: Not tested" FontSize="11" Foreground="Gray" Margin="0,5,0,0"/>
                    </Grid>
                </GroupBox>

                <!-- ESXi Root Credentials -->
                <GroupBox Header="🖥️ ESXi Root Credentials" Margin="0,0,0,20" 
                          BorderBrush="#FFDDDDDD" BorderThickness="1" Background="White">
                    <Grid Margin="15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.ColumnSpan="3" 
                                   Text="ESXi root credentials for host-level operations during migration"
                                   FontSize="12" Foreground="Gray" Margin="0,0,0,15"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="ESXiUsernameTextBox" 
                                 Style="{StaticResource CredentialTextBoxStyle}" Text="root"
                                 ToolTip="ESXi root username (typically 'root')"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                        <PasswordBox Grid.Row="2" Grid.Column="1" Name="ESXiPasswordBox" 
                                     Style="{StaticResource CredentialPasswordBoxStyle}"
                                     ToolTip="ESXi root password"/>
                        <Button Grid.Row="2" Grid.Column="2" Content="🧪 Test" Width="60" Height="32"
                                Click="TestESXiConnection_Click" Style="{StaticResource CredentialButtonStyle}"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Test Host:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Name="TestESXiHostTextBox" 
                                 Style="{StaticResource CredentialTextBoxStyle}"
                                 ToolTip="ESXi host IP or FQDN for testing credentials"/>

                        <CheckBox Grid.Row="4" Grid.Column="1" Name="SaveESXiCredentialsCheckBox" 
                                  Content="💾 Save ESXi credentials for this session" Margin="0,5,0,0"/>

                        <TextBlock Grid.Row="5" Grid.Column="1" Name="ESXiStatusText" 
                                   Text="Status: Not tested" FontSize="11" Foreground="Gray" Margin="0,5,0,0"/>
                    </Grid>
                </GroupBox>

                <!-- Additional Migration Credentials -->
                <GroupBox Header="🔧 Additional Migration Credentials" Margin="0,0,0,20" 
                          BorderBrush="#FFDDDDDD" BorderThickness="1" Background="White">
                    <Grid Margin="15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.ColumnSpan="2" 
                                   Text="Optional credentials for specialized migration scenarios"
                                   FontSize="12" Foreground="Gray" Margin="0,0,0,15"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Service Account:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="ServiceAccountTextBox" 
                                 Style="{StaticResource CredentialTextBoxStyle}"
                                 ToolTip="Service account for automated operations"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Service Password:" VerticalAlignment="Center"/>
                        <PasswordBox Grid.Row="2" Grid.Column="1" Name="ServicePasswordBox" 
                                     Style="{StaticResource CredentialPasswordBoxStyle}"
                                     ToolTip="Service account password"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Domain Admin:" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Name="DomainAdminTextBox" 
                                 Style="{StaticResource CredentialTextBoxStyle}"
                                 ToolTip="Domain administrator for AD operations"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Domain Password:" VerticalAlignment="Center"/>
                        <PasswordBox Grid.Row="4" Grid.Column="1" Name="DomainPasswordBox" 
                                     Style="{StaticResource CredentialPasswordBoxStyle}"
                                     ToolTip="Domain administrator password"/>

                        <CheckBox Grid.Row="5" Grid.Column="1" Name="SaveAdditionalCredentialsCheckBox" 
                                  Content="💾 Save additional credentials for this session" Margin="0,5,0,0"/>
                    </Grid>
                </GroupBox>

                <!-- Security Notice -->
                <Border Background="#FFF9F9F9" BorderBrush="#FFDDDDDD" BorderThickness="1" 
                        CornerRadius="5" Padding="15" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="🔒 Security Information" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#FF666666">
                            • Credentials are encrypted using Windows DPAPI (Data Protection API)<LineBreak/>
                            • Stored credentials are only accessible by the current user on this machine<LineBreak/>
                            • Credentials are automatically cleared when the application closes<LineBreak/>
                            • Test connections verify credentials without storing them permanently<LineBreak/>
                            • For production use, consider using service accounts with minimal required permissions
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="🧪 Test All Connections" Width="150" Click="TestAllConnections_Click" 
                    Style="{StaticResource CredentialButtonStyle}"/>
            <Button Content="💾 Save Credentials" Width="120" Click="SaveCredentials_Click" 
                    Style="{StaticResource CredentialButtonStyle}"/>
            <Button Content="🗑️ Clear All" Width="100" Click="ClearCredentials_Click" 
                    Style="{StaticResource CredentialButtonStyle}" Background="#FFDC3545" BorderBrush="#FFDC3545"/>
            <Button Content="❌ Cancel" Width="80" Click="Cancel_Click" 
                    Style="{StaticResource CredentialButtonStyle}" Background="Gray" BorderBrush="Gray"/>
            <Button Content="✅ OK" Width="80" Click="OK_Click" 
                    Style="{StaticResource CredentialButtonStyle}"/>
        </StackPanel>
    </Grid>
</Window>
